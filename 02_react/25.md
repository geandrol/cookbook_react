<h1>Projeto Blog Pessoal - Implementando o Componente Card e Lista Postagens</h1>

Com os componentes de Listagem constru√≠dos, agora iremos implementar sua l√≥gica e consumir as postagens cadastradas em nosso Back End e exib√≠-las em nossa aplica√ß√£o.

Para isso, iremos consumir o endpoint Get de Postagens da nossa API, cujo a fun√ß√£o √© fornecer uma lista de todas as postagens dispon√≠veis na aplica√ß√£o. Essa opera√ß√£o √© usada para listar postagens cadastradas na base de dados, permitindo ao usu√°rio da API obter uma vis√£o geral das postagens dispon√≠veis e realizar a√ß√µes espec√≠ficas, como adicionar, atualizar ou remover, assim como fizemos com Temas.

<h2>üë£ Passo 01 - Cadastrar uma Nova Postagem</h2>

Nosso primeiro passo ser√° cadastrar uma nova Postagem em nossa API, para que quando o nosso componente de Listagem estiver totalmente implementado, podermos ter a certeza que sua l√≥gica foi adicionada corretamente.

1. Portanto, abra a sua aplica√ß√£o Back End em Deploy, acessando o caminho adicionado em sua Service. 
2. Ap√≥s a aplica√ß√£o ser exibida, voc√™ ver√° a tela do Swagger.
3. Encontre os recursos relacionados a Postagens, e na rota de Cadastro de Postagens (rota Post) **Cadastre uma Nova Postagem**.

<br>

<div align="center"><img src="https://i.imgur.com/sDV4eGK.png" title="source: imgur.com" /></div>

<br>

4. Ap√≥s isso, podemos come√ßar a implementar nossa l√≥gica ao componente.

| [![source: imgur.com](https://camo.githubusercontent.com/656a7f920290b1249ff1f60c486fa6cb7ad1af445115fac67cf14a9abd41a208/68747470733a2f2f692e696d6775722e636f6d2f684f67577653632e706e67)](https://camo.githubusercontent.com/656a7f920290b1249ff1f60c486fa6cb7ad1af445115fac67cf14a9abd41a208/68747470733a2f2f692e696d6775722e636f6d2f684f67577653632e706e67) | **ATEN√á√ÉO:** *Vale refor√ßar que os passos descritos acima s√≥ ser√£o necess√°rios caso voc√™ ainda n√£o tenha cadastrado uma Postagem no Banco de Dados da sua API. Caso j√° tenha feito esse processo, voc√™ seguir adiante para os pr√≥ximos passos, mas em ambas as situa√ß√µes, voc√™ precisa ter pelo menos um Tema cadastrado, para podermos realizar o Relacionamento entre as Tabelas/Objetos.* |
| ------------------------------------------------------------ | ------------------------------------------------------------ |



<h2><img src="https://i.imgur.com/H9wEgsJ.png" title="source: imgur.com" width="5%"/>Passo 02 - Implementando a L√≥gica no Componente Card Postagens</h2>

1. Abra o componente **CardPostagens.tsx** localizado dentro da pasta **postagens**.
2. Insira os c√≥digos abaixo, nos locais indicados:

<br>

```tsx
import { Link } from 'react-router-dom'
import Postagem from '../../../models/Postagem'

interface CardPostagensProps {
    post: Postagem
}

function CardPostagens({ post }: CardPostagensProps) {
    return (
        <div className='border-slate-900 border 
            flex flex-col rounded overflow-hidden justify-between'>

            <div>
                <div className="flex w-full bg-indigo-400 py-2 px-4 items-center gap-4">
                    <img src={post.usuario?.foto} className='h-12 rounded-full' 
                        alt="Imagem do Usu√°rio" />
                    <h3 className='text-lg font-bold text-center uppercase'>{post.usuario?.nome}</h3>
                </div>
                <div className='p-4'>
                    <h4 className='text-lg font-semibold uppercase'>{post.titulo}</h4>
                    <p>{post.texto}</p>
                    <p>Tema: {post.tema?.descricao}</p>
                    <p>Data: {new Intl.DateTimeFormat(undefined, {
                        dateStyle: 'full',
                        timeStyle: 'medium',
                    }).format(new Date(post.data))}</p>
                </div>
            </div>
            <div className="flex">
                <Link to={`/editarPostagem/${post.id}`} className='w-full text-white bg-indigo-400 
                    hover:bg-indigo-800 flex items-center justify-center py-2'>
                    <button>Editar</button>
                </Link>
                <Link to={`/deletarPostagem/${post.id}`} className='text-white bg-red-400 
                    hover:bg-red-700 w-full flex items-center justify-center'>
                    <button>Deletar</button>
                </Link>
            </div>
        </div>
    )
}

export default CardPostagens
```

<br>

**Vamos analisar o nosso c√≥digo:**

**Linha 02:** Fazemos a importa√ß√£o da Model de Postagens, j√° que iremos trabalhar com Props.

**Linhas 04 a 06:** Estamos definindo uma interface chamada **CardPostagensProps** que especifica as propriedades que componente **CardPostagens.tsx** espera receber. No caso, ele espera receber um Objeto que ser√° referenciado atrav√©s do nome **post**, e seu formato deve seguir as propriedades da Model Postagem, ou seja, que possua todos os atributos descritos em sua model.

**Linha 08:** Ap√≥s definir a estrutura da Props desse componente, passamos sua propriedade para o componente usando a **Desestrutura√ß√£o**, acessando a propriedade **post** diretamente.

**Linha 15:** Como cada Card mostrar√° as informa√ß√µes das Postagens de modo din√¢mico, come√ßamos por exibir a propriedade Foto, do Usu√°rio que cadastrou essa Postagem.

**Linha 16:** Na linha de baixo, para completar o cabe√ßalho com as informa√ß√µes do usu√°rio respons√°vel por essa Postagem, por meio da Props post, informamos o nome do usu√°rio.

**Linha 18:** Aqui, informamos a primeira informa√ß√£o relacionada inteiramente ao objeto Postagem, passando para dentro da Tag o **titulo** da Postagem que foi enviada dentro de uma propriedade para esse Card.

**Linha 19:** Na sequ√™ncia passamos o **texto** da Postagem.

**Linha 20:** Informamos o **Tema** vinculado a essa Postagem.

**Linha 21 a 24:** Atrav√©s da biblioteca nativa do Javascript, **INTL**, convertemos a data cadastrada no Back End, para um formato mais amig√°vel para ser mostrado junto ao card.

<br>

<div align="center"><img src="https://i.imgur.com/B3ZSzXD.png" title="source: imgur.com" /></div>

<br>

**Linhas 28 e 31:** Nessas linhas, o componente **Link** √© usado para criar um link para a p√°gina de edi√ß√£o e exclus√£o da postagem atrav√©s de sua propriedade **to**. Atrav√©s dessa propriedade, definimos as rotas que ser√£o usadas nessas a√ß√µes, incluindo junto a elas o ID da postagem em quest√£o, de maneira id√™ntica ao que fizemos com Temas.

<br>

<div align="center"><img src="https://i.imgur.com/sUk06d1.png" title="source: imgur.com" /></div>

<br>

<h2><img src="https://i.imgur.com/H9wEgsJ.png" title="source: imgur.com" width="5%"/>Passo 03 - Implementando a L√≥gica no Componente Lista Postagens</h2>

Com a l√≥gica dos Cards implementadas, vamos ao Lista Postagens.

1. Abra o componente **ListaPostagens.tsx** localizado dentro da pasta **postagens**.
2. Insira os c√≥digos abaixo, nos locais indicados:

<br>

```tsx
import { useContext, useEffect, useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { Dna } from 'react-loader-spinner';

import { buscar } from '../../../services/Service';
import { AuthContext } from '../../../contexts/AuthContext';

import Postagem from '../../../models/Postagem';
import CardPostagens from '../cardPostagens/CardPostagens';

function ListaPostagens() {

    const navigate = useNavigate();

    const [postagens, setPostagens] = useState<Postagem[]>([]);

    const { usuario, handleLogout } = useContext(AuthContext);
    const token = usuario.token;

    async function buscarPostagens() {
        try {
            await buscar('/postagens', setPostagens, {
                headers: {
                    Authorization: token,
                },
            })

        } catch (error: any) {
            if (error.toString().includes('403')) {
                alert('O token expirou, favor logar novamente')
                handleLogout()
            }
        }
    }

    useEffect(() => {
        if (token === '') {
            alert('Voc√™ precisa estar logado')
            navigate('/');
        }
    }, [token])

    useEffect(() => {
        buscarPostagens()
    }, [postagens.length])

    return (
```

<br>

```tsx
       <>
            {postagens.length === 0 && (
                <Dna
                    visible={true}
                    height="200"
                    width="200"
                    ariaLabel="dna-loading"
                    wrapperStyle={{}}
                    wrapperClass="dna-wrapper mx-auto"
                />
            )}

            <div className='container mx-auto my-4 
            grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4'>

                {postagens.map((postagem) => (
                    <CardPostagens key={postagem.id} post={postagem} />
                ))}

            </div>
        </>
    )
}

export default ListaPostagens
```

<br>

<div align="center"><img src="https://i.imgur.com/fj64Cev.png" title="source: imgur.com" /></div>

<br>

**Vamos analisar o nosso c√≥digo:**

**Linhas 01 a 03:** Fazemos as importa√ß√µes do Componente Dna - que ser√° um Loader, e dos Hooks tanto do React quanto da React-Router-Dom.

**Linhas 05 a 06:** Fazemos a importa√ß√£o da **Service buscar** e do nosso **Contexto**.

**Linhas 08 a 09:** Fazemos a importa√ß√£o da **Model Postagem** e do componente **CardPostagens**.

**Linha 13:** Criamos uma constante chamada **navigate** e indicamos que ela recebe o **hook useNavigate()**. Com isso, agora a vari√°vel **navigate consegue redirecionar a pessoa para outras rotas/componentes.**

**Linha 15:** Nesta linha de c√≥digo, criamos um estado chamado **postagens**, que √© iniciado como um array vazio. Utilizando o conceito de **Generics do Typescript (estamos passando uma tipagem para o hook useState)**, indicamos que o tipo de dados que ser√° armazenada nesse estados ser√°: um array de Objetos da Model Postagem, ou seja, v√°rias postagens.

**Linhas 17 a 18:** Nestas linhas, estamos acessando o nosso contexto **atrav√©s do hook useContext informando o arquivo de contexto que ele deve acessar - AuthContext**. Feito isso, **desestruturamos os valores do contexto** para que essas propriedades possam ser usadas no componente. Em seguida, definimos uma constante chamada **token** e passamos o valor do token do usu√°rio logado para ela.

<br>

<div align="center"><img src="https://i.imgur.com/rpPUJQ9.png" title="source: imgur.com" /></div>

<br>

**Linhas 20 a 34:** A fun√ß√£o ass√≠ncrona **buscarPostagens** √© respons√°vel por realizar o processo de busca de postagens criadas no Back End, atualizando o estado **postagens** com os resultados encontrados. Ela tamb√©m lida com exce√ß√µes, especificamente tratando a situa√ß√£o em que um erro de autoriza√ß√£o (c√≥digo 403) ocorre, alertando o usu√°rio sobre a expira√ß√£o do token e executando o logout, se necess√°rio.

**Linhas 21 a 28:** Dentro do bloco **TRY**, invocamos a service **buscar**. Seguindo sua estrutura, passamos a URL da rota de temas definida no Back End, a fun√ß√£o **setPostagens** que ir√° atualizar o estado de postagens ap√≥s a conclus√£o do processo, e no √∫ltimo argumento (header), um objeto contendo o token. A palavra-chave **await** indica que essa opera√ß√£o √© ass√≠ncrona e aguarda a conclus√£o antes de continuar.

**Linha 22:** No argumento header da **Service Buscar**, passamos um objeto. Dentro desse objeto, adicionamos uma propriedade chamada **headers**. Sua responsabilidade aqui √© armazenar outro objeto, com a propriedade chamada **Authorization**, que ter√° como valor o **token** do usu√°rio logado.

**Linhas 28 a 33:** Caso houve algum tipo de erro no processo dentro do bloco **TRY**, a estrutura **CATCH** captura o erro, prevenindo um exce√ß√£o que possa travar ou comprometer o funcionamento da aplica√ß√£o, e al√©m disso, exibe um alerta, informando que ocorreu algum erro no processo.

**Linhas 29 a 32:** Dentro do bloco **CATCH**, tratamos dos erros que possam ocorrer durante a busca de postagens. Se o erro incluir a mensagem '403', presume-se que o token de autentica√ß√£o expirou, e a fun√ß√£o **handleLogout** √© chamada para efetuar o logout do usu√°rio.

<br>

<div align="center"><img src="https://i.imgur.com/NxYQgEf.png" title="source: imgur.com" /></div>

<br>

**Linhas 36 a 41:** Aqui, o **useEffect** monitora sua vari√°vel de depend√™ncia **token**, sempre que o token for uma string vazia (indicando que o usu√°rio n√£o est√° autenticado), ele exibe um alerta informando ao usu√°rio que ele precisa estar logado e o redireciona para a p√°gina de login. **Esse c√≥digo ser√° usado, caso o usu√°rio tente acessar essa p√°gina diretamente pela URL da aplica√ß√£o, sem ter passado pelo Login.**

**Linhas 43 a 45:** Nesse segundo useEffect, o tamanho do array **postagens** √© monitorado. Sempre que esse tamanho mudar, a fun√ß√£o **buscarPostagens()** √© executada. Essa l√≥gica √© usada para garantir que a lista de postagens seja atualizada automaticamente sempre que houver uma mudan√ßa no n√∫mero de postagens, mantendo os dados atualizados na interface do usu√°rio.

**Linhas 49 a 58:** Utilizando a **Renderiza√ß√£o Condicional** com um **IF Tern√°rio**, sempre que o array **postagens** estiver vazio, esse trecho de c√≥digo renderiza o Componente de Carregamento DNA. Essa l√≥gica √© √∫til para indicar visualmente que a lista de postagens est√° sendo carregada ou que n√£o h√° postagens dispon√≠veis quando a p√°gina √© carregada pela primeira vez. Quando novas postagens s√£o adicionados ao array, esse componente de carregamento desaparece, e as postagens reais s√£o exibidas.

**Linha 50:** Adicionamos o componente Loader DNA da Biblioteca **react-loader-spinner**, o configurando de acordo com nossa necessidade.

<br>

<div align="center"><img src="https://i.imgur.com/BaxBGfV.png" title="source: imgur.com" /></div>

<br>

**Linhas 63 a 65:** Esse trecho de c√≥digo mapeia os elementos do array **postagens** e renderiza o componente **CardPostagem** para cada item dentro do Array. Isso √© comum em React para criar uma lista de elementos com base em dados din√¢micos. Cada componente CardPostagem representa uma postagem espec√≠fico da lista.

* **{postagens.map((postagem) => (...))}**: O m√©todo **map** √© uma fun√ß√£o dispon√≠vel a todo array. Ela √© usada para iterar sobre cada elemento do array e aplicar uma transforma√ß√£o ou renderiza√ß√£o a cada item.
* **CardPostagem key={postagem.id} posts={postagem}**: Aqui renderizamos o componente CardPostagem para cada postagem dentro do Array. O atributo **key** √© usado para fornecer uma chave √∫nica para cada componente na lista, o que ajuda o React a otimizar o processo de renderiza√ß√£o. A propriedade **posts** √© usada para passar os dados da postagem para o componente CardPostagem. Cada postagem √© representada individualmente por um componente CardPostagem.

<h2><img src="https://i.imgur.com/H9wEgsJ.png" title="source: imgur.com" width="5%"/>Passo 04 - Atualizando o Componente Home</h2>

A exibi√ß√£o de Postagens √© acessada tanto em sua respectiva rota quanto diretamente na p√°gina Home. Isso se d√° pois adicionamos o Componente ListaPostagens dentro da Home. Portanto, para atingir esse resultado, siga os passos abaixo:

1. Abra o Componente Home localizado dentro da pasta **pages**
2. Na sequ√™ncia, adicione os c√≥digos indicados:

```tsx
import ListaPostagens from "../../components/postagens/listaPostagens/ListaPostagens"

function Home() {
    return (
        <>
            <div className="bg-indigo-900 flex justify-center">
                <div className='container grid grid-cols-2 text-white'>
                    <div className="flex flex-col gap-4 items-center justify-center py-4">
                        <h2 className='text-5xl font-bold'>
                            Seja Bem Vinde!
                        </h2>
                        <p className='text-xl'>
                            Expresse aqui seus pensamentos e opni√µes
                        </p>

                        <div className="flex justify-around gap-4">
                            <div className='rounded text-white border-white 
                                            border-solid border-2 py-2 px-4'>
                                Nova Postagem
                            </div>
                        </div>
                    </div>

                    <div className="flex justify-center ">
                        <img
                            src="https://i.imgur.com/fyfri1v.png"
                            alt="Imagem P√°gina Home"
                            className='w-2/3'
                        />
                    </div>
                </div>
            </div>

            <ListaPostagens />
        </>
    )
}

export default Home
```

<br>

<div align="center"><img src="https://i.imgur.com/GMKQMFq.png" title="source: imgur.com" /></div>

<br>

**Vamos analisar o nosso c√≥digo:**

**Linha 01:** Fazemos a importa√ß√£o do componente **ListaPostagens**.

**Linha 29:** Adicionamos o componente **ListaPostagens** na Home.

<br>

<h2><img src="https://i.imgur.com/H9wEgsJ.png" title="source: imgur.com" width="5%"/>Passo 05 - Testando o Componente</h2>

1. Execute o projeto atrav√©s do comando abaixo:

```bash
yarn dev
```

2. Pressione a tecla **o** do seu teclado para abrir o Projeto no Navegador.
3. Com o projeto aberto, logue na aplica√ß√£o.
4. Se tudo estiver correto, voc√™ j√° deve ser capaz de visualizar as postagens cadastradas diretamente na Home.

<br>

<div align="center"><img src="https://i.imgur.com/kaidnwq.png" title="source: imgur.com" /></div>

<br>

5. Na sequ√™ncia, clique no local indicado:

<br>

<div align="center"><img src="https://i.imgur.com/PoD6M8U.png" title="source: imgur.com" /></div>

<br>

6. E ent√£o, voc√™ ser√° redirecionado a p√°gina de listagem de postagens. Ap√≥s o t√©rmino do carregamento s√£o mostrados as Postagens em cada Card.

<br>

<div align="center"><img src="https://i.imgur.com/RQKmDyv.png" title="source: imgur.com" /></div>

<br>

7. Ao final, deslogue da aplica√ß√£o.

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="5%"/> <a href="https://github.com/Yuri-stack/BlogPessoalReact_Fonte/tree/25_Card_Lista_Postagem_Logica" target="_blank"><b>C√≥digo fonte do projeto</b></a></div>

<br /><br />

<div align="left"><a href="README.md"><img src="https://i.imgur.com/XMgF3gl.png" title="source: imgur.com" width="3%"/>Voltar</a></div>
