<h1>Projeto Blog Pessoal - Implementando o Componente Card e Lista Temas</h1>

Com os componentes de Listagem constru√≠dos, agora iremos implementar sua l√≥gica e consumir os temas cadastrados em nosso Back End e exib√≠-los em nossa aplica√ß√£o.

Para isso, iremos consumir o endpoint **getAll** da nossa API, cujo a fun√ß√£o √© fornecer uma lista de todos os temas dispon√≠veis na aplica√ß√£o. Essa opera√ß√£o √© usada para listar temas cadastrados na base de dados, permitindo ao usu√°rio da API obter uma vis√£o geral dos temas dispon√≠veis e realizar a√ß√µes espec√≠ficas, como adicionar, atualizar ou remover.

<h2>üë£ Passo 01 - Cadastrar um Novo Tema</h2>

Nosso primeiro passo ser√° cadastrar um novo Tema em nossa API, para que quando o nosso componente de Listagem estiver totalmente implementado, podermos ter a certeza que sua l√≥gica foi adicionada corretamente.

1. Portanto, abra a sua aplica√ß√£o Back End em Deploy, acessando o caminho adicionado em sua Service. 
2. Ap√≥s a aplica√ß√£o ser exibida, voc√™ ver√° a tela do Swagger.
3. Encontre os recursos relacionados a Temas, e na rota de Cadastro de Temas (rota Post) **Cadastre um Novo Tema**.

<br>

IMAGEM PRINT 83

<br>

IMAGEM PRINT 84

<br>

<h2><img src="https://i.imgur.com/izFuHID.png" title="source: imgur.com" width="4%"/>Passo 02 - Atualizar a Classe de Servi√ßo - Service de Busca</h2>

Com pelos menos um tema cadastrado em nosso Back End, vamos partir agora para a constru√ß√£o da Service que ter√° a fun√ß√£o de Buscar os Temas e carreg√°-los em nosso Front End.

1. Vamos come√ßar adicionando a service de cadastro de usu√°rios. Portanto, abra o arquivo **Service.ts** localizado dentro da pasta **service**.
2. Abaixo da **Service de Cadastro de Usu√°rio**, adicione l√≥gica a seguir:

```ts
export const buscar = async (url: string, setDados: Function, header: Object) => {
    const resposta = await api.get(url, header)
    setDados(resposta.data)
}
```

IMAGEM PRINT 85

<br>

**Vamos analisar o nosso c√≥digo:**

**Linhas 17 a 20:** Constru√≠mos e exportamos a fun√ß√£o ass√≠ncrona chamada **buscar**, que ser√° respons√°vel por todas as opera√ß√µes relacionadas a busca de recursos em nossa aplica√ß√£o, ou seja, ao buscar Temas, Postagens e informa√ß√µes especificas de algum recurso, usaremos essa Service.

**Linha 17:** Essa Arrow function aceita tr√™s argumentos:

- **url:** √â uma string que representa o endpoint da API para onde a solicita√ß√£o GET ser√° feita. Essa URL ser√° anexada √† URL base definida anteriormente na inst√¢ncia do Axios (api).
- **setDados:** √â uma fun√ß√£o que ser√° usada para atualizar os dados na sua aplica√ß√£o com a resposta da solicita√ß√£o.
- **header:** √â um objeto que cont√©m um cabe√ßalho HTTP, como informa√ß√µes de autentica√ß√£o.

**Linha 18:** Esta linha faz uma solicita√ß√£o GET para a URL especificada no par√¢metro de mesmo nome usando a inst√¢ncia do Axios, **api**. Como essa Service ir√° buscar informa√ß√µes, n√£o enviamos dados a ela. Logo, o segundo par√¢metro que passamos para essa requisi√ß√£o √© o argumento **header**, que cont√©m o token do usu√°rio autenticado, permitindo o acesso dessa fun√ß√£o ao Back. A palavra reservada **await** √© usada para esperar a conclus√£o da solicita√ß√£o antes de continuarmos o fluxo da fun√ß√£o.

**Linha 19:** Ap√≥s a conclus√£o da solicita√ß√£o, a resposta da API √© armazenada na vari√°vel **resposta**. O c√≥digo ent√£o chama a fun√ß√£o **setDados**, passando **resposta.data como argumento**. Isso atualiza os dados na nossa aplica√ß√£o com os dados retornados pela API ap√≥s a busca bem-sucedida dos temas.

| [![source: imgur.com](https://camo.githubusercontent.com/656a7f920290b1249ff1f60c486fa6cb7ad1af445115fac67cf14a9abd41a208/68747470733a2f2f692e696d6775722e636f6d2f684f67577653632e706e67)](https://camo.githubusercontent.com/656a7f920290b1249ff1f60c486fa6cb7ad1af445115fac67cf14a9abd41a208/68747470733a2f2f692e696d6775722e636f6d2f684f67577653632e706e67) | **ATEN√á√ÉO:** *Observe que o c√≥digo da service Buscar possui algumas diferen√ßas em rela√ß√£o as services anteriores. A mais importante, √© o uso do par√¢metro HEADER. Esse par√¢metro ir√° conter o Token de Autentica√ß√£o do Usu√°rio, e DEVE ser passado a essa fun√ß√£o, j√° que as services que iremos construir daqui para frente, s√£o todas protegidas pela Security do Spring, e precisam do Token JWT para autorizar a execu√ß√£o de determinada fun√ß√£o.* |
| ------------------------------------------------------------ | ------------------------------------------------------------ |



<h2><img src="https://i.imgur.com/H9wEgsJ.png" title="source: imgur.com" width="5%"/>Passo 03 - Implementando a L√≥gica no Componente Card Temas</h2>

1. Abra o componente **CardTemas.tsx** localizado dentro da pasta **temas**.
2. Insira os c√≥digos abaixo, nos locais indicados:

<br>

```tsx
import { Link } from 'react-router-dom'
import Tema from '../../../models/Tema'

interface CardTemaProps {
    tema: Tema
}

function CardTemas({ tema }: CardTemaProps) {
    return (
        <div className='border flex flex-col rounded-2xl overflow-hidden justify-between'>
            <header className='py-2 px-6 bg-indigo-800 text-white font-bold text-2xl'>
                Tema
            </header>

            <p className='p-8 text-3xl bg-slate-200 h-full'>
                {tema.descricao}
            </p>

            <div className="flex">
                <Link to={`/editarTema/${tema.id}`}
                    className='w-full text-slate-100 bg-indigo-400 hover:bg-indigo-800 
                        flex items-center justify-center py-2'>
                    <button>Editar</button>
                </Link>

                <Link to={`/deletarTema/${tema.id}`}
                    className='text-slate-100 bg-red-400 hover:bg-red-700 w-full 
                        flex items-center justify-center'>
                    <button>Deletar</button>
                </Link>
            </div>

        </div>
    )
}

export default CardTemas
```

<br>

IMAGEM PRINT 86

<br>

**Vamos analisar o nosso c√≥digo:**

**Linha 02:** Fazemos a importa√ß√£o da Model de Temas, j√° que iremos trabalhar com Props.

**Linhas 04 a 06:** Estamos definindo uma interface chamada **CardTemaProps** que especifica as propriedades que co componente **CardTemas.tsx** espera receber. No caso, ele espera receber um Objeto que ser√° referenciado atrav√©s do nome **tema**, e seu formato deve seguir as propriedades da Model Tema, ou seja, que possua **ID e Descri√ß√£o.**

**Linha 08:** Ap√≥s definir a estrutura da Props desse componente, passamos sua propriedade para o componente usando a **Desestrutura√ß√£o**, acessando a propriedade tema diretamente.

**Linha 16:** Como cada Card ir√° ter uma descri√ß√£o para cada Tema, aqui deixamos o campo din√¢mico, passando para a Tag de Paragrafo a **descri√ß√£o** do Tema que foi enviado como uma propriedade para esse Card.

**Linhas 20 e 23:** Nessas linhas, o componente **Link** √© usado para criar um link para a p√°gina de edi√ß√£o e dele√ß√£o do tema atrav√©s de sua propriedade **to**. Atrav√©s dessa propriedade, definimos as rotas que ser√£o usadas nessas a√ß√µes, incluindo junto a elas o ID do tema em quest√£o. Isso se d√° pois, tanto na rota de dele√ß√£o e de edi√ß√£o que ser√£o constru√≠das futuramente, os componentes dessas rotas ir√£o acessar esse ID que veio pela URL e fazer uma requisi√ß√£o ao Back, para pegar os dados e executar suas respectivas fun√ß√µes.

<h2><img src="https://i.imgur.com/H9wEgsJ.png" title="source: imgur.com" width="5%"/>Passo 04 - Implementando a L√≥gica no Componente Lista Temas</h2>

Com a l√≥gica dos Cards implementadas, vamos ao Lista Temas.

1. Abra o componente **ListaTemas.tsx** localizado dentro da pasta **temas**.
2. Insira os c√≥digos abaixo, nos locais indicados:

<br>

```tsx
import { useContext, useEffect, useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { Dna } from 'react-loader-spinner';

import { buscar } from '../../../services/Service';
import { AuthContext } from '../../../contexts/AuthContext';

import Tema from '../../../models/Tema';
import CardTemas from '../cardTemas/CardTemas';

function ListaTemas() {

    const [temas, setTemas] = useState<Tema[]>([]);

    let navigate = useNavigate();

    const { usuario, handleLogout } = useContext(AuthContext);
    const token = usuario.token;

    async function buscarTemas() {
        try {
            await buscar('/temas', setTemas, {
                headers: { Authorization: token },
            })
        } catch (error: any) {
            if (error.toString().includes('403')) {
                alert('O token expirou, favor logar novamente')
                handleLogout()
            }
        }
    }

    useEffect(() => {
        if (token === '') {
            alert('Voc√™ precisa estar logado');
            navigate('/login');
        }
    }, [token])

    useEffect(() => {
        buscarTemas()
    }, [temas.length])

    return (
```

<br>

```tsx
        <>
            {temas.length === 0 && (
                <Dna
                    visible={true}
                    height="200"
                    width="200"
                    ariaLabel="dna-loading"
                    wrapperStyle={{}}
                    wrapperClass="dna-wrapper mx-auto"
                />
            )}

            <div className="flex justify-center w-full my-4">
                <div className="container flex flex-col">
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">

                        {temas.map((tema) => (
                            <>
                                <CardTemas key={tema.id} tema={tema} />
                            </>
                        ))}

                    </div>
                </div>
            </div>
        </>
    )
```

<br>

PRINT IMAGEM 87

<br>

**Vamos analisar o nosso c√≥digo:**

**Linhas 01 a 03:** Fazemos as importa√ß√µes do Componente Dna - que ser√° um Loader, e dos Hooks tanto do React quanto da React-Router-Dom.

**Linhas 05 a 06:** Fazemos a importa√ß√£o da **Service buscar** e do nosso **Contexto**.

**Linhas 08 a 09:** Fazemos a importa√ß√£o da **Model Tema** e do componente **CardTemas**.

**Linha 13:** Criamos uma constante chamada **navigate** e indicamos que ela recebe o **hook useNavigate()**. Com isso, agora a vari√°vel **navigate consegue redirecionar a pessoa para outras rotas/componentes.**

**Linha 15:** Nesta linha de c√≥digo, criamos um estado chamado **temas**, que √© iniciado como um array vazio. Utilizando o conceito de **Generics do Typescript (estamos passando uma tipagem para o hook useState)**, indicamos que o tipo de dados que ser√° armazenada nesse estados ser√°: um array de Objetos da Model Tema, ou seja, v√°rios temas..

**Linhas 17 a 18:** Nestas linhas, estamos acessando o nosso contexto **atrav√©s do hook useContext informando o arquivo de contexto que ele deve acessar - AuthContext**. Feito isso, **desestruturamos os valores do contexto** para que essas propriedades possam ser usadas no componente. Em seguida, definimos uma constante chamada **token** e passamos o valor do token do usu√°rio logado para ela.

**Linhas 20 a 32:** A fun√ß√£o ass√≠ncrona **buscarTemas** √© respons√°vel por realizar o processo de busca de temas criados no Back End, atualizando o estado **temas** com os resultados encontrados. Ela tamb√©m lida com exce√ß√µes, especificamente tratando a situa√ß√£o em que um erro de autoriza√ß√£o (c√≥digo 403) ocorre, alertando o usu√°rio sobre a expira√ß√£o do token e executando o logout, se necess√°rio.

**Linhas 21 a 24:** Dentro do bloco **TRY**, invocamos a service **bucar**. Seguindo sua estrutura, passamos a URL da rota de temas definida no Back End, a fun√ß√£o **setTemas** que ir√° atualizar o estado de temas ap√≥s a conclus√£o do processo, e no √∫ltimo argumento (header), um objeto contendo o token. A palavra-chave **await** indica que essa opera√ß√£o √© ass√≠ncrona e aguarda a conclus√£o antes de continuar.

**Linha 23:** No argumento header da **Service Buscar**, passamos um objeto. Dentro desse objeto, adicionamos uma propriedade chamada **headers**. Sua responsabilidade aqui √© armazenar outro objeto, com a propriedade chamada **Authorization**, que ter√° como valor o **token** do usu√°rio logado.

IMAGEM REFERENTE AO IMNSONIA E ESSE C√ìDIGO

**Linhas 26 a 31:** Caso houve algum tipo de erro no processo dentro do bloco **TRY**, a estrutura **CATCH** captura o erro, prevenindo um exce√ß√£o que possa travar ou comprometer o funcionamento da aplica√ß√£o, e al√©m disso, exibe um alerta, informando que ocorreu algum erro no processo.

**Linhas 27 a 29:** Dentro do **CATCH**, √© verificado **se a exce√ß√£o (erro) capturada tem uma mensagem que inclui a string '403'.** Isso indica um erro de autoriza√ß√£o, com a resposta de **status HTTP 403 (N√£o Autorizado).** Se essa condi√ß√£o for verdadeira, **nosso c√≥digo exibe um alerta indicando que o token expirou,** pedindo ao usu√°rio para fazer o login novamente, e logo em seguida executa a fun√ß√£o **handleLogout()**, que desloga o usu√°rio, o enviando para o Login.

**Linhas 34 a 39:** Aqui, o **useEffect** monitora sua vari√°vel de depend√™ncia **token**, sempre que o token for uma string vazia (indicando que o usu√°rio n√£o est√° autenticado), ele exibe um alerta informando ao usu√°rio que ele precisa estar logado e o redireciona para a p√°gina de login. **Esse c√≥digo ser√° usado, caso o usu√°rio tente acessar essa p√°gina diretamente pela URL da aplica√ß√£o, sem ter passado pelo Login.**

**Linhas 41 a 43:** Nesse segundo useEffect, o tamanho do array **temas** √© monitorado. Sempre que esse tamanho mudar, a fun√ß√£o **buscarTemas()** √© executada. Essa l√≥gica √© usada para garantir que a lista de temas seja atualizada automaticamente sempre que houver uma mudan√ßa no n√∫mero de temas, mantendo os dados atualizados na interface do usu√°rio.

**Linhas 47 a 56:** Utilizando a **Renderiza√ß√£o Condicional** com um **IF Tern√°rio**, sempre que o array **temas** estiver vazio, esse trecho de c√≥digo renderiza o Componente de Carregamento DNA. Essa l√≥gica √© √∫til para indicar visualmente que a lista de temas est√° sendo carregada ou que n√£o h√° temas dispon√≠veis quando a p√°gina √© carregada pela primeira vez. Quando novos temas s√£o adicionados ao array, esse componente de carregamento desaparece, e os temas reais s√£o exibidos.

**Linha 48:** Adicionamos o componente Loader DNA da Biblioteca **react-loader-spinner**, o configurando de acordo com nossa necessidade.

**Linhas 62 a 66:** Esse trecho de c√≥digo mapeia os elementos do array **temas** e renderiza o componente **CardTema** para cada tema dentro do Array. Isso √© comum em React para criar uma lista de elementos com base em dados din√¢micos, como uma lista de temas em um aplicativo. Cada componente CardTema representa um tema espec√≠fico da lista.

* **{temas.map((tema) => (...))}**: O m√©todo **map** √© fun√ß√£o dispon√≠vel a todo array. Ela √© usada para iterar sobre cada elemento do array e aplicar uma transforma√ß√£o ou renderiza√ß√£o a cada item.
* **CardTema key={tema.id} tema={tema}**: Aqui renderizamos o componente CardTema  para cada tema dentro do Array. O atributo **key** √© usado para fornecer uma chave √∫nica para cada componente na lista, o que ajuda o React a otimizar o processo de renderiza√ß√£o. O atributo **tema** √© usado para passar os dados do tema como propriedade para o componente CardTema. Cada tema √© representado individualmente por um componente CardTema.



<h2><img src="https://i.imgur.com/H9wEgsJ.png" title="source: imgur.com" width="5%"/>Passo 05 - Testando o Componente</h2>

1. Execute o projeto atrav√©s do comando abaixo:

```bash
yarn dev
```

2. Pressione a tecla **o** do seu teclado para abrir o Projeto no Navegador
3. Com o projeto aberto, logue na aplica√ß√£o e depois clique no local indicado na imagem
4. E ent√£o, voc√™ ser√° redirecionado a p√°gina de listagem de temas. Ap√≥s o t√©rmino do carregamento s√£o mostrados os Temas em cada Card

PRINT 88

PRINT 89

<br /><br />

<div align="left"><a href="README.md"><img src="https://i.imgur.com/XMgF3gl.png" title="source: imgur.com" width="3%"/>Voltar</a></div>